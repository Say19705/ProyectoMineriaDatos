---
title: "Proyecto de Minería de datos. Matrimonios de Guatemala"
author: "Ayleen Rubio 19003, Andrés Say 19705, Andreé Toledo 18439"
date: "25/3/2021"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#"C:/Users/andre/OneDrive/Documentos/3er año/1er semestre/Minería de datos/proyecto/ProyectoMineriaDatos"
#C:/Users/Andree/Documents/GitHub/

knitr::opts_knit$set(root.dir="C:/Users/andre/OneDrive/Documentos/3er año/1er semestre/Minería de datos/proyecto/ProyectoMineriaDatos")
```

# Proyecto No. 1. Análisis de matrimonios en Guatemala  

Actualmente en Guatemala es legal contraer matrimonio hasta cumplir la mayoría de edad, es decir los 18 años, tanto para los hombres como para las mujeres, sin embargo, esto no fue decretado en el Código Civil hasta agosto de 2017. Anteriormente en el 2015 ya se había hecho una reforma para elevar la edad mínima de matrimonio a los 18 años pero en estas reformas aún era posible contraer matrimonio a los 16 años con el permiso de un juez. 
Antes de todas estas reformas en los Códigos Civil y Penal, era posible contraer matrimonio desde que se cumplía los 14 años de edad y, en caso de agresiones sexuales, era permitido el matrimonio civil entre ofendida y ofensor en relaciones con menores de edad, lo cual cambió en el año 2005 al ser declarado Inconstitucional, posteriormente en el año 2009 La Ley contra la Violencia Sexual, Explotación y Trata de Personas agravó las sentencias en los casos de delitos sexuales con víctimas menores de 18 años.
-unionestempranas.org

A pesar de que se haya prohibido contraer matrimonio siendo menores de edad, según una declaración del defensor de la Niñez de la PDH Luis de León en el año 2019, aún se encuentran registros de matrimonio entre dos personas menores, ocurriendo principalmente en departamentos occidentales indígenas de Huehuetenango, Quetzaltenango y San Marcos, además de la capital del país. Según se informó, algunas instituciones públicas y juristas no tenían conocimientos sobre tal prohibición, razón por la cual tuvieron lugar estos matrimonios sin algún tipo de dificultad. -Prensa Libre: redacción AFP, 2019.

En la presente investigación se busca estudiar los casos de matrimonio desde el año 2009 hasta el año 2019 para verificar si existe algún cambio en la ocurrencia de matrimonios a partir de los años de las reformas y para estudiar los casos de matrimonios con menores de edad y verificar si estos suelen ser con otras personas menores de edad o con mayores de edad, de ser el caso, se busca estudiar a su vez la diferencia de edad entre ambos cónyuges.

## Análisis exploratorio  

Para poder hacer un análisis exploratorio de los datos de 2009 a 2019 ha sido necesario hacer una limpieza de estos en los siguientes aspectos:
Principalmente se cuenta con las columnas que describen departamento de registro, municipio de registro, mes de registro, año de registro, clase de unión, número de nupcias contraídas por el hombre y por la mujer, edad del hombre y de la mujer, grupo étnico del hombre y de la mujer, nacionalidad del hombre y de la mujer, ocupación del hombre y de la mujer, escolaridad del hombre y de la mujer, área geográfica de ocurrencia y día de ocurrencia. Sin embargo, no todos estos datos se encontraban en todas las bases de datos o no contaban con el mismo nombre de variable o se encontraban con diferencias entre mayúsculas y minúsculas, de la misma manera se encontró que en algunos casos el año de ocurrencia se encontraba descrito únicamente como 9 o 10 en vez de contar con el año completo, por lo que fue necesario hacer cambios para generalizar todo.
Como estándar se han utilizado los años 2015, 2016 y 2017, por lo que las bases de los años anteriores se han adaptado al formato de estas tres, agregando las columnas de número de nupcias del hombre y la mujer en los años 2010, 2011, 2012, 2013 y 2014, año de ocurrencia en 2012, 2013 y 2014, escolaridad del hombre y de la mujer y día de ocurrencia en el año 2009 y por último se ha agregamo la columna de área geográfica de ocurrencia en los años 2018 y 2019.
Luego de agregar estar columnas se ha hecho las modificaciones necesarias en el formato de los datos o respectivos nombres de las columnas para que todos los años contaran con el mismo formato y pudieran ser unificados en una sola base de datos.



```{r, echo=FALSE}
options(java.parameters = "-Xmx1024m")
library(RWeka)
library(e1071)
library(caret)
library(magrittr)
library(dplyr)
library(plyr)

library(cluster)
library(dplyr)
library(cluster)
library(e1071)
library(mclust)

library(fpc)
library(NbClust)
library(factoextra)
#library(tidyverse)
library(readr)

library(randomForest)
library(ggplot2)
library(broom)
library(ggpubr)

library(corrplot)
library(mctest)
library(caret)
#library(Amelia)

library(caretEnsemble)
library(psych)
library(mice)
library(GGally)
library(rpart)
library(e1071)

library(haven)

library(clValid)

datos2009 <- read_sav("datosMat2009.sav")
datos2010 <- read_sav("datosMat2010.sav")
datos2011 <- read_sav("datosMat2011.sav")
datos2012 <- read_sav("datosMat2012.sav")
datos2013 <- read_sav("datosMat2013.sav")
datos2014 <- read_sav("datosMat2014.sav")
datos2015 <- read_sav("datosMat2015.sav")
datos2016 <- read_sav("datosMat2016.sav")
datos2017 <- read_sav("datosMat2017.sav")
datos2018 <- read_sav("datosMat2018.sav")
datos2019 <- read_sav("datosMat2019.sav")

#Se usarán como estandar las bases de 2015,2016,2017 /no se si colocar las columnas

#----------------Modificaciones 2009 -------------------
#Crear columnas en dataset 2009 ESCHOM, ESCMUJ y DIAOCU
ESCHOM <- rnorm(nrow(datos2009))
datos2009 <- cbind(datos2009, ESCHOM)
datos2009$ESCHOM <- "None"

ESCMUJ <- rnorm(nrow(datos2009))
datos2009 <- cbind(datos2009, ESCMUJ)
datos2009$ESCMUJ <- "None"

DIAOCU <- rnorm(nrow(datos2009))
datos2009 <- cbind(datos2009, DIAOCU)
datos2009$DIAOCU <- "None"
#View(datos2009)

#cambiar los nombres de NUPHON, NUPMUJ a NUNUHO, NUNUMU 2009
cnames <- colnames(datos2009)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "NUPHON"){
    nombresN[i] <- "NUNUHO"
  }
  else if(cnames[i] == "NUPMUJ"){
    nombresN[i] <- "NUNUMU"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2009) <- nombresN

#cambiar AREAG por AREAGOCU, OCUHOM, OCUMUJ por CIUOHOM, CIUOMUJ
cnames <- colnames(datos2009)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "AREAG"){
    nombresN[i] <- "AREAGOCU"
  }
  else if(cnames[i] == "OCUHOM"){
    nombresN[i] <- "CIUOHOM"
  }
  else if(cnames[i] == "OCUMUJ"){
    nombresN[i] <- "CIUOMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2009) <- nombresN
datos2009$AÑOREG <- ifelse(datos2009$AÑOREG == 9, 2009, datos2009$AÑOREG)
datos2009$AÑOREG <- ifelse(datos2009$AÑOREG == 10, 2010, datos2009$AÑOREG)
datos2009$AÑOOCU <- ifelse(datos2009$AÑOOCU == 9, 2009, datos2009$AÑOOCU)
datos2009$AÑOOCU <- ifelse(datos2009$AÑOOCU == 10, 2010, datos2009$AÑOOCU)

#-----------------------Modificaciones 2010--------------------
#Crear columnas en dataset 2010 NUNUHO, NUNUMU
NUNUHO <- rnorm(nrow(datos2010))
datos2010 <- cbind(datos2010,NUNUHO)
datos2010$NUNUHO <- "None"

NUNUMU <- rnorm(nrow(datos2010))
datos2010 <- cbind(datos2010, NUNUMU)
datos2010$NUNUMU <- "None"

#Poner todas en uppercase 2010
cnames <- colnames(datos2010)
mayu2010 = c()

for (i in 1:length(cnames)){
  mayu2010[i] <- toupper(cnames[i])  
}

colnames(datos2010)<-mayu2010

#cambiar AREAG por AREAGOCU, OCUHOM, OCUMUJ
cnames <- colnames(datos2010)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "AREAG"){
    nombresN[i] <- "AREAGOCU"
  }
  else if(cnames[i] == "OCUHOM"){
    nombresN[i] <- "CIUOHOM"
  }
  else if(cnames[i] == "OCUMUJ"){
    nombresN[i] <- "CIUOMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2010) <- nombresN
#---------------------Modificaciones 2011----------------------
#Crear columnas en dataset 2011 NUNUHO, NUNUMU
NUNUHO <- rnorm(nrow(datos2011))
datos2011 <- cbind(datos2011,NUNUHO)
datos2011$NUNUHO <- "None"

NUNUMU <- rnorm(nrow(datos2011))
datos2011 <- cbind(datos2011, NUNUMU)
datos2011$NUNUMU <- "None"


#Poner todas en uppercase 2011
cnames <- colnames(datos2011)
mayu2011 = c()

for (i in 1:length(cnames)){
  mayu2011[i] <- toupper(cnames[i])  
}

colnames(datos2011)<-mayu2011

#cambiar AREAG por AREAGOCU OCUHOM, OCUMUJ
cnames <- colnames(datos2011)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "AREAG"){
    nombresN[i] <- "AREAGOCU"
  }
  else if(cnames[i] == "OCUHOM"){
    nombresN[i] <- "CIUOHOM"
  }
  else if(cnames[i] == "OCUMUJ"){
    nombresN[i] <- "CIUOMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2011) <- nombresN
#-------------------------Modificaciones 2012------------------------
#Crear columnas en dataset 2012 AÑOOCU, NUNUHO, NUNUMU
AÑOOCU <- rnorm(nrow(datos2012))
datos2012 <- cbind(datos2012, AÑOOCU)
datos2012$AÑOOCU <- "None"

NUNUHO <- rnorm(nrow(datos2012))
datos2012 <- cbind(datos2012,NUNUHO)
datos2012$NUNUHO <- "None"

NUNUMU <- rnorm(nrow(datos2012))
datos2012 <- cbind(datos2012, NUNUMU)
datos2012$NUNUMU <- "None"

#View(datos2012)

#cambiar AREAG por AREAGOCU, OCUHOM, OCUMUJ
cnames <- colnames(datos2012)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "AREAG"){
    nombresN[i] <- "AREAGOCU"
  }
  else if(cnames[i] == "OCUHOM"){
    nombresN[i] <- "CIUOHOM"
  }
  else if(cnames[i] == "OCUMUJ"){
    nombresN[i] <- "CIUOMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2012) <- nombresN
#------------------------Modificaciones 2013------------------------
#Crear columnas en dataset 2013 AÑOOCU, NUNUHO, NUMUNU
AÑOOCU <- rnorm(nrow(datos2013))
datos2013 <- cbind(datos2013, AÑOOCU)
datos2013$AÑOOCU <- "None"

NUNUHO <- rnorm(nrow(datos2013))
datos2013 <- cbind(datos2013,NUNUHO)
datos2013$NUNUHO <- "None"

NUNUMU <- rnorm(nrow(datos2013))
datos2013 <- cbind(datos2013, NUNUMU)
datos2013$NUNUMU <- "None"


#hacer la división del 2013
#PUEHOM
datos2013$PUEHOM <- ifelse(datos2013$PUEHOM ==  2,1,datos2013$PUEHOM)
datos2013$PUEHOM <- ifelse(datos2013$PUEHOM ==  3,1,datos2013$PUEHOM)
datos2013$PUEHOM <- ifelse(datos2013$PUEHOM ==  5,1,datos2013$PUEHOM)
datos2013$PUEHOM <- ifelse(datos2013$PUEHOM ==  4,2,datos2013$PUEHOM)

#PUEMUJ
datos2013$PUEMUJ <- ifelse(datos2013$PUEMUJ ==  2,1,datos2013$PUEMUJ)
datos2013$PUEMUJ <- ifelse(datos2013$PUEMUJ ==  3,1,datos2013$PUEMUJ)
datos2013$PUEMUJ <- ifelse(datos2013$PUEMUJ ==  5,1,datos2013$PUEMUJ)
datos2013$PUEMUJ <- ifelse(datos2013$PUEMUJ ==  4,2,datos2013$PUEMUJ)

#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2013)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2013) <- nombresN

#-----------------------Modificaciones 2014---------------------------
#Crear columnas en dataset 2014 AÑOOCU, NUNUHO, NUNUMU
AÑOOCU <- rnorm(nrow(datos2014))
datos2014 <- cbind(datos2014, AÑOOCU)
datos2014$AÑOOCU <- "None"

NUNUHO <- rnorm(nrow(datos2014))
datos2014 <- cbind(datos2014,NUNUHO)
datos2014$NUNUHO <- "None"

NUNUMU <- rnorm(nrow(datos2014))
datos2014 <- cbind(datos2014, NUNUMU)
datos2014$NUNUMU <- "None"

#hacer la división del 2014
#PUEHOM
datos2014$PUEHOM <- ifelse(datos2014$PUEHOM ==  2,1,datos2014$PUEHOM)
datos2014$PUEHOM <- ifelse(datos2014$PUEHOM ==  3,1,datos2014$PUEHOM)
datos2014$PUEHOM <- ifelse(datos2014$PUEHOM ==  5,1,datos2014$PUEHOM)
datos2014$PUEHOM <- ifelse(datos2014$PUEHOM ==  4,2,datos2014$PUEHOM)

#PUEMUJ
datos2014$PUEMUJ <- ifelse(datos2014$PUEMUJ ==  2,1,datos2014$PUEMUJ)
datos2014$PUEMUJ <- ifelse(datos2014$PUEMUJ ==  3,1,datos2014$PUEMUJ)
datos2014$PUEMUJ <- ifelse(datos2014$PUEMUJ ==  5,1,datos2014$PUEMUJ)
datos2014$PUEMUJ <- ifelse(datos2014$PUEMUJ ==  4,2,datos2014$PUEMUJ)

#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2014)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2014) <- nombresN
#-------------------Modificaciones 2015--------------------------
#hacer la división del 2015
#PUEHOM
datos2015$PUEHOM <- ifelse(datos2015$PUEHOM ==  2,1,datos2015$PUEHOM)
datos2015$PUEHOM <- ifelse(datos2015$PUEHOM ==  3,1,datos2015$PUEHOM)
datos2015$PUEHOM <- ifelse(datos2015$PUEHOM ==  5,1,datos2015$PUEHOM)
datos2015$PUEHOM <- ifelse(datos2015$PUEHOM ==  4,2,datos2015$PUEHOM)

#PUEMUJ
datos2015$PUEMUJ <- ifelse(datos2015$PUEMUJ ==  2,1,datos2015$PUEMUJ)
datos2015$PUEMUJ <- ifelse(datos2015$PUEMUJ ==  3,1,datos2015$PUEMUJ)
datos2015$PUEMUJ <- ifelse(datos2015$PUEMUJ ==  5,1,datos2015$PUEMUJ)
datos2015$PUEMUJ <- ifelse(datos2015$PUEMUJ ==  4,2,datos2015$PUEMUJ)

#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2015)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2015) <- nombresN
#-------------------Modificaciones 2016--------------------------
#hacer la división del 2016
#PUEHOM
datos2016$PUEHOM <- ifelse(datos2016$PUEHOM ==  2,1,datos2016$PUEHOM)
datos2016$PUEHOM <- ifelse(datos2016$PUEHOM ==  3,1,datos2016$PUEHOM)
datos2016$PUEHOM <- ifelse(datos2016$PUEHOM ==  5,1,datos2016$PUEHOM)
datos2016$PUEHOM <- ifelse(datos2016$PUEHOM ==  4,2,datos2016$PUEHOM)

#PUEMUJ
datos2016$PUEMUJ <- ifelse(datos2016$PUEMUJ ==  2,1,datos2016$PUEMUJ)
datos2016$PUEMUJ <- ifelse(datos2016$PUEMUJ ==  3,1,datos2016$PUEMUJ)
datos2016$PUEMUJ <- ifelse(datos2016$PUEMUJ ==  5,1,datos2016$PUEMUJ)
datos2016$PUEMUJ <- ifelse(datos2016$PUEMUJ ==  4,2,datos2016$PUEMUJ)
 
#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2016)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2016) <- nombresN
#-------------------Modificaciones 2017--------------------------
#hacer la división del 2017
#PUEHOM
datos2017$PUEHOM <- ifelse(datos2017$PUEHOM ==  2,1,datos2017$PUEHOM)
datos2017$PUEHOM <- ifelse(datos2017$PUEHOM ==  3,1,datos2017$PUEHOM)
datos2017$PUEHOM <- ifelse(datos2017$PUEHOM ==  5,1,datos2017$PUEHOM)
datos2017$PUEHOM <- ifelse(datos2017$PUEHOM ==  4,2,datos2017$PUEHOM)

#PUEMUJ
datos2017$PUEMUJ <- ifelse(datos2017$PUEMUJ ==  2,1,datos2017$PUEMUJ)
datos2017$PUEMUJ <- ifelse(datos2017$PUEMUJ ==  3,1,datos2017$PUEMUJ)
datos2017$PUEMUJ <- ifelse(datos2017$PUEMUJ ==  5,1,datos2017$PUEMUJ)
datos2017$PUEMUJ <- ifelse(datos2017$PUEMUJ ==  4,2,datos2017$PUEMUJ)

#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2017)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2017) <- nombresN
#-------------------Modificaciones 2018--------------------------
#Crear columna AREAGOCU en dataset 2018
AREAGOCU <- rnorm(nrow(datos2018))
datos2018 <- cbind(datos2018, AREAGOCU)
datos2018$AREAGOCU <- "None"

#PUEHOM
datos2018$PUEHOM <- ifelse(datos2018$PUEHOM ==  2,1,datos2018$PUEHOM)
datos2018$PUEHOM <- ifelse(datos2018$PUEHOM ==  3,1,datos2018$PUEHOM)
datos2018$PUEHOM <- ifelse(datos2018$PUEHOM ==  5,1,datos2018$PUEHOM)
datos2018$PUEHOM <- ifelse(datos2018$PUEHOM ==  4,2,datos2018$PUEHOM)

#PUEMUJ
datos2018$PUEMUJ <- ifelse(datos2018$PUEMUJ ==  2,1,datos2018$PUEMUJ)
datos2018$PUEMUJ <- ifelse(datos2018$PUEMUJ ==  3,1,datos2018$PUEMUJ)
datos2018$PUEMUJ <- ifelse(datos2018$PUEMUJ ==  5,1,datos2018$PUEMUJ)
datos2018$PUEMUJ <- ifelse(datos2018$PUEMUJ ==  4,2,datos2018$PUEMUJ)
 
#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2018)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2018) <- nombresN
#-------------------Modificaciones 2019--------------------------
#Crear columna AREAGOCU en dataset 2019
AREAGOCU <- rnorm(nrow(datos2019))
datos2019 <- cbind(datos2019, AREAGOCU)
datos2019$AREAGOCU <- "None"

#PUEHOM
datos2019$PUEHOM <- ifelse(datos2019$PUEHOM ==  2,1,datos2019$PUEHOM)
datos2019$PUEHOM <- ifelse(datos2019$PUEHOM ==  3,1,datos2019$PUEHOM)
datos2019$PUEHOM <- ifelse(datos2019$PUEHOM ==  5,1,datos2019$PUEHOM)
datos2019$PUEHOM <- ifelse(datos2019$PUEHOM ==  4,2,datos2019$PUEHOM)

#PUEMUJ
datos2019$PUEMUJ <- ifelse(datos2019$PUEMUJ ==  2,1,datos2019$PUEMUJ)
datos2019$PUEMUJ <- ifelse(datos2019$PUEMUJ ==  3,1,datos2019$PUEMUJ)
datos2019$PUEMUJ <- ifelse(datos2019$PUEMUJ ==  5,1,datos2019$PUEMUJ)
datos2019$PUEMUJ <- ifelse(datos2019$PUEMUJ ==  4,2,datos2019$PUEMUJ)

#cambiar los nombres de PUEHOM Y PUEMUJ a GETHOM GETMUJ
cnames <- colnames(datos2019)
nombresN = c()
for(i in 1:length(cnames)){
  if(cnames[i] == "PUEHOM"){
    nombresN[i] <- "GETHOM"
  }
  else if(cnames[i] == "PUEMUJ"){
    nombresN[i] <- "GETMUJ"
  }
  else{
    nombresN[i] <- cnames[i]
  }
}
colnames(datos2019) <- nombresN
#----------------------------------------------------------------

#Ver databeses
# View(datos2009)
# View(datos2010)
# View(datos2011)
# View(datos2012)
# View(datos2013)
# View(datos2014)
# View(datos2015)
# View(datos2016)
# View(datos2017)
# View(datos2018)
# View(datos2019)
#---------- Ya con todas las bases con las mismas columnas (cant columnas y nombres) podemos unirlas 
#------------------------Unión de las bases-------------------------
#---------- Ya con todas las bases con las mismas columnas (cant columnas y nombres) podemos unirlas 
datos2009 <- datos2009 %>%
  mutate_if(is.labelled,list(as_factor))
datos2010 <- datos2010 %>%
  mutate_if(is.labelled,list(as_factor))
datos2011 <- datos2011 %>%
  mutate_if(is.labelled,list(as_factor))
datos2012 <- datos2012 %>%
  mutate_if(is.labelled,list(as_factor))
datos2013 <- datos2013 %>%
  mutate_if(is.labelled,list(as_factor))
datos2014 <- datos2014 %>%
  mutate_if(is.labelled,list(as_factor))
datos2015 <- datos2015 %>%
  mutate_if(is.labelled,list(as_factor))
datos2016 <- datos2016 %>%
  mutate_if(is.labelled,list(as_factor))
datos2017 <- datos2017 %>%
  mutate_if(is.labelled,list(as_factor))
datos2018 <- datos2018 %>%
  mutate_if(is.labelled,list(as_factor))
datos2019 <- datos2019 %>%
  mutate_if(is.labelled,list(as_factor))

l = list(datos2009,datos2010,datos2011,datos2012,datos2013,datos2014,datos2015,datos2016,datos2017,datos2018,datos2019)
datosMatrimonio <- do.call("rbind",l)
datosMatrimonio$EDADHOM <- as.numeric(factor(datosMatrimonio$EDADHOM))
datosMatrimonio$EDADMUJ <- as.numeric(factor(datosMatrimonio$EDADMUJ))
```
## Informe de análisis exploratorio 
En este informe usted podrá leer los hallazgos sobre los matrimonios, basado en los datos obtenidos del INE

```{r Matrimonios, echo=FALSE}
summary(datosMatrimonio)
```
En el siguiente cuadro se muestra el tipo de dato de cada variable:

```{r data, echo=FALSE}
#
str(datosMatrimonio)
```

El dataset tiene 23 variables, el departamento, municipalidad, mes y año de registro, la casificación de la unión, las edades de los hombres y mujer, el grupo étnico de los hombres y mujeres, su nacionalidad, su oficio, la cantidad de nupcias de cada uno. Luego tambien se encuentran las variables de ocurrencia. el departamento, municipalidad, mes, año, area y dia de ocurrencia. Por último se encuentra la escolaridad de cada uno.
Las variables más interesantes para el porpósito de la investigación son lass que proporcionan información de la fecha del matrimonio. Otras con gran potencial, son las edades de los cónyuges, ya que con ellas podemos analizar cual es la tendencia de matrimonios de menores, diferencias de edades etc.


## Análisis de variables cuantitativas
### Registros de matrimonio
#### Prueba de normalidad para  registros de matrimonios:
```{r normalHist, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
ggplot(data = datosMatrimonio, aes(x = AÑOREG)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(datosMatrimonio$popularity),
                            sd = sd(datosMatrimonio$popularity)))+
  ggtitle("Histograma con curva normal teórica de los registros de matrimonios por año") + 
  theme_bw()
```  

Como es de esperarse, no es posible observar que exista una relación en el histograma de registros de matrimonios con las reformas planteadas para la prohibición de matrimonios con menores de edad, ya que parece que la cantidad de matrimonios ha sido bastante constante durante los años. Según el histograma mostrado, la cantidad de matrimonios por año no sigue una distribución normal.

### Diagrama de caja y bigotes
```{r normalBox, echo=FALSE}
boxplot(datosMatrimonio$AÑOREG, main = "Caja y Bigotes de registro de matrimonios por año", xlab = "Registro por año")
```

Como dicho anteriormente, no hay muchos grupos atípicos ya que se concentran dentro de un intervalo.Según este diagrama, sí se cuenta con normalidad en la cantidad de matrimonios por año.

### Diagrama de qqnormal
```{r normalQQ, echo=FALSE}
qqnorm(datosMatrimonio$AÑOREG, col="blue")
qqline(datosMatrimonio$AÑOREG, col="red")
```

Aunque en el diagrama qqnormal parece que se sigue una distribución normal al encontrarse muchos de los datos alineados, hay bastantes datos que se encuentran fuera de la linea de tendencia, por lo que no se cumple con normalidad en la cantidad de matrimonios por año.

En conclusión, la cantidad de matrimonios por año no sigue una distribución normal.

## Registros de Edad hombre
### Prueba de normalidad para la edad del hombre:
```{r normalHistEdadHombre, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
ggplot(data = datosMatrimonio, aes(x = EDADHOM)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(datosMatrimonio$EDADHOM),
                            sd = sd(datosMatrimonio$EDADHOM)))+
  ggtitle("Histograma con curva normal teórica de las edades de los hombres") + 
  theme_bw()
```  

En este histograma se puede observar que los datos tienen relativamente forma de campana, sin embargo, es evidente que estos tienen un sesgo hacia la izquierda, esto quiere decir que usualmente la edad entre los hombres en un matrimonio se encuentra debajo de los 30. Sin embargo, es importante mencionar que como dato interesante se puede observar que hay casos de matrimonios en hombres de más de 75 años. 
Debido al sesgo, la edad de los hombres en matrimonios no sigue una distribución normal.

### Diagrama de caja y bigotes
```{r normalBoxEdadHombre, echo=FALSE}
boxplot(datosMatrimonio$EDADHOM, main = "Caja y Bigotes de edad de los hombres al casarse", xlab = "edad")
```

Se evidencia la gran cantidad de datos atípicos en el diagrama, se encuentran muy dispersos arriba de la media y del extremo superior que se encuentra al rededor de los 30 años. Esto quiere decir que la edad de los hombres en el matrimonio no sigue una distribución normal.

### Diagrama qqnormal
```{r normalQQEdadHombre, echo=FALSE}
qqnorm(datosMatrimonio$EDADHOM, col="blue")
qqline(datosMatrimonio$EDADHOM, col="red")
```

Como puede observarse, es muy notable en el diagrama qqnormal que los datos no siguen una distribución acorde a la linea de tendencia, esto quiere decir que la edad del hombre en el matrimonio no sigue una distribución normal.

En conclusión, la edad de los hombres en el matrimonio no sigue una distribución normal.

## Registros de edad de mujeres
### Prueba de normalidad para la edad de la mujer:
```{r normalHistEdadMuje, echo=FALSE}
#install.packages("ggplot2",repos = "http://cran.us.r-project.org")
library (ggplot2)
ggplot(data = datosMatrimonio, aes(x = EDADMUJ)) + 
  geom_histogram(aes(y=..density.., fill = ..count..))+
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C")+
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(datosMatrimonio$EDADMUJ),
                            sd = sd(datosMatrimonio$EDADMUJ)))+
  ggtitle("Histograma con curva normal teórica de las edades de las mujeres") + 
  theme_bw()
```  

De la misma manera que en el histograma de hombres, hay una forma relativa de campana, sin embargo se nota un gran sesgo a la izquierda que demuestra que la edad de mujeres en el matrimonio suele ser debajo de los 25, aunque también se cuentan con algunos datos arriba de los 75 años. Debido al sesgo, la edad de mujeres en el matrimonio no sigue una distribución normal.

### Diagrama de caja y bigotes
```{r normalBoxEdadMujer, echo=FALSE}
boxplot(datosMatrimonio$EDADMUJ, main = "Caja y Bigotes de edad de las mujeres al casarse", xlab = "edad")
```

En este diagrama de caja y bigotes es posible ver una gran cantidad de datos atípicos arriba del extremo superior que se encuentra al rededor de los 30 años, muy similar al diagrama de la edad de los hombres, por lo que de la misma manera no se cuenta con normalidad en la edad de las mujeres en el matrimonio.

### Diagrama qqnormal
```{r normalQQEdadMujer, echo=FALSE}
qqnorm(datosMatrimonio$EDADMUJ, col="blue")
qqline(datosMatrimonio$EDADMUJ, col="red")
```

Como puede observarse, los valores en este diagrama evidentemente no siguen con una distribución normal ya que no esán sobre la linea de tendencia, por lo que la edad de las mujeres en el matrimonio no sigue una distribución normal.

En conclusión, la edad de las mujeres en el matrimonio no sigue una distribución normal.

## Tabla de frecuencias para variables cualitativas

### Tabla de frecuencias para el departamento de ocurrencia
```{r frecuenciaDepartamento, echo=FALSE}

#DepOcurren <- data.frame(table(do.call(c, lapply(datosMatrimonio$DEPOCU, function(x) unlist(strsplit(x, "\\|"))))))
table(datosMatrimonio$DEPOCU)
```

Como puede observarse, el departamento en el que suele haber más matrimonios es en Guatemala, seguido por Huehuetenango y luego por Alta Verapaz.

### Tabla de frecuencias para el municipio de ocurrencia
```{r frecuenciaMunicipio, echo=FALSE}

#MuniOcurren <- data.frame(table(do.call(c, lapply(datosMatrimonio$MUPOCU, function(x) unlist(strsplit(x, "\\|"))))))
table(datosMatrimonio$MUPOCU)
```

De la misma manera, es Guatemala el municipio que cuenta con la mayor cantidad de matrimonios.

### Tabla de frecuencias para la escolaridad del hombre
```{r frecuenciaEscolaridadHombre, echo=FALSE}

#EscolHom <- data.frame(table(do.call(c, lapply(datosMatrimonio$ESCHOM, function(x) unlist(strsplit(x, "\\|"))))))
table(datosMatrimonio$ESCHOM)
```

Como puede observarse, el nivel de escolaridad más común entre los hombres es primaria, con 255,480 casos, mientras que el más bajo es el de post grado con 181 casos.

### Tabla de frecuencias para la escolaridad de la Mujer
```{r frecuenciaEscolaridadMujer, echo=FALSE}

#EscolMuj <- data.frame(table(do.call(c, lapply(datosMatrimonio$ESCMUJ, function(x) unlist(strsplit(x, "\\|"))))))
table(datosMatrimonio$ESCMUJ)
```

Como puede observarse, el nivel de escolaridad más común entre las mujeres es primaria, con 222076 casos, mientras que el más bajo es el de post grado con 126 casos.

### Tabla de frecuencias para el grupo étnico del hombre
```{r frecuenciaEtniaHombre, echo=FALSE}
#EtHom <- data.frame(table(do.call(c, lapply(datosMatrimonio$GETHOM, function(x) unlist(strsplit(x, "\\|"))))))
table(datosMatrimonio$GETHOM)
```

Coomo puede observarse, el grupo étnico más común al que pertenecen los hombres en la base de datos es no indígena.

### Tabla de frecuencias para el grupo étnico de la mujer
```{r frecuenciaEtniaMujer, echo=FALSE}

#EtHom <- data.frame(table(do.call(c, lapply(datosMatrimonio$GETMUJ, function(x) unlist(strsplit(x, "\\|"))))))
table(datosMatrimonio$GETMUJ)
```

De la misma manera, puede observarse que el grupo étnico más común al que pertenecen las mujeres en la base de datos es no indígena.

## Correlacion entre edades de los cónyuges

```{r CorrelacionEdades, echo=FALSE}
plot(x = datosMatrimonio$EDADHOM, y= datosMatrimonio$EDADMUJ, xlab= "Edad del Hombre", ylab= "Edad de la mujer", main = "Correlación entre las edades de los cónyuges")
abline(lm(datosMatrimonio$EDADMUJ ~ datosMatrimonio$EDADHOM), col = "red")
```

Evidentementeno se puede observar correlación, sin embargo, es posible observar que hay hombres con edades muy altas con mujeres debajo de los 18 años,cabe mencionar que es importante filtrar los datos atipicos o norepresentativos del dataset

Como se puede ver, existen muchos datos extraños dentro del data set, estudiándolo se ha encontrado una gran cantidad de 1's y otros datos en donde la edad de los "cónyuges" es incluso menor a 5 años, por lo que la presencia de estos datos nos ha llevado a buscar la naturaleza de las variables, por lo que revisando la lista de variables del INE de cada año, pudimos darnos cuenta que la edad más pequeña para mujeres durante los años fue 12 y de los hombres 14, por lo tanto se hizo un nuevo dataset para estudiar con precisión lo que deseamos estudiar. Se ha filtrado de la base de datos de matrimonios los valores en donde la edad de la mujer era menor a 18 (por el objetivo) y mayor a 12 años (para eliminar los datos no significativos o no lógicos), asimismo se filtró los datos en donde el hombre es menor a 14 años (de igual manera para eliminar esos datos confusos).

```{r FiltroDeEdades, echo=FALSE}
#install.packages("tidyverse")
#library(tidyverse)
#datosMatrimonio$EDADMUJ <- as.numeric(factor(datosMatrimonio$EDADMUJ))
menorEdadMuj <- datosMatrimonio %>% filter(EDADMUJ < 18)
menorEdadMuj <- menorEdadMuj %>% filter(EDADMUJ >= 12)
menorEdad <- menorEdadMuj %>% filter(EDADHOM >= 14)

```


```{r CorrEdadesFiltro, echo=FALSE}
plot(x = menorEdad$EDADHOM, y= menorEdad$EDADMUJ, xlab= "Edad del Hombre", ylab= "Edad de la mujer", main = "Correlación entre las edades, mujeres menores de 18")
abline(lm(menorEdad$EDADMUJ ~ menorEdad$EDADHOM), col = "red")
```

Filtrando los datos en donde las mujeres son menores a 18 años, es posible observar que una gran cantidad de mujeres se encuentran comprometidas con hombres mucho mayores a ellas, existen datos atípicos muy extensos y preocupantes, cabe mencionar que los datos que se encuentran en el fondo (muy pocos pero si existen) se encuentran así debido a que los datos no son indicados en el diagrama.

## Departamentos en donde se llevan a cabo los matrimonios de mujeres menores de edad
```{r tabla por departamentos del dataset, echo = FALSE}
library(dplyr)
library(magrittr)

menorEdadGraph <- menorEdad %>% filter(EDADHOM >= 18)

#departamentos
table(menorEdadGraph$DEPOCU)
```

Puede observarse que muchos de estos matrimonios se llevan a cabo en el departamento de Guatemala, donde una gran población son ladinos.

## Municipios en donde se llevan a cabo los matrimonios de mujeres menores de edad
```{r tabla por municipios de casamientos, echo = FALSE}
library(dplyr)
library(magrittr)

depMun <- (menorEdadGraph$MUPOCU)
#departamentos
table(depMun)
#print(nrow(menorEdad))
#print(nrow(menorEdadGraph))

```

De la misma manera, puede observarse que la mayor cantidad de ocurrencias se encuentra en Guatemala.

## La etnia de la mujer en donde es más común este evento
```{r tabla por etnia de la mujer, echo = FALSE}
library(dplyr)
library(magrittr)

etniaMujer <- (menorEdadGraph$GETMUJ)
#departamentos
table(etniaMujer)
#print(nrow(menorEdad))
#print(nrow(menorEdadGraph))

```

Se puede observar que no hay una diferencia significativa en estos grupos, lo cual es importante para saber si el hecho de que ocurran los matrimonios con menores de edad, es algo que se ve influido por la cultura.

## La etnia del hombre en donde es más común este evento
```{r tabla por etnia del hombre, echo = FALSE}
library(dplyr)
library(magrittr)

etniaHombre <- (menorEdadGraph$GETHOM)
#departamentos
table(etniaHombre)
#print(nrow(menorEdad))
#print(nrow(menorEdadGraph))

```


Se puede observar que no hay una diferencia significativa en estos grupos, lo cual es importante para saber si el hecho de que ocurran los matrimonios con menores de edad, es algo que se ve influido por la cultura.

# -----------------------------------Clustering--------------------------------

```{r Preprocesamiento, echo=FALSE}
menorEdad$AÑOOCU <- as.numeric(factor(menorEdad$AÑOOCU))
datosClustering <- menorEdad[,c(4,6,7,19)]
summary(datosClustering)
```

Se trabajará con las siguientes variables que tienen formato int para formas grupos: AÑOREG, ALOOCU, EDADHOM,EDADMUJ. Esto debido a que son variables que se pueden clasificar por grupos y los resultados pueden ser interpretados.

Para saber la mejor cantidad de clusters a utilizar, se hará lo siguiente:

```{r cantClusters, echo=FALSE}
wss <- (nrow(datosClustering[,1:4])-1)*sum(apply(datosClustering[,1:4],2,var))

for (i in 2:10) 
  wss[i] <- sum(kmeans(datosClustering[,1:4], centers=i)$withinss)

plot(1:10, wss, type="b", xlab="Number of Clusters",  ylab="Within groups sum of squares")

```

Puede observarse en el gráfico que el codo se encuentra en el valor 4, por lo que esta es la cantidad adecuada de clusters que se deben utilizar.

## Agrupamiento por medio de k-means  
```{r kmeans, echo=FALSE}
km<-kmeans(datosClustering[,1:4],4,iter.max =100)
datosClustering$grupo<-km$cluster
plotcluster(datosClustering[,1:4],km$cluster)

gkm1<- datosClustering[datosClustering$grupo==1,]
gkm2<- datosClustering[datosClustering$grupo==2,]
gkm3<- datosClustering[datosClustering$grupo==3,]
gkm4<- datosClustering[datosClustering$grupo==4,]
```

Se puede observar cómo los datos se encuentran divididos en 4 grupos, verde, rojo, azul y negr, en donde todos los grupos, excepto el azul, parecen estar bastante concentrados en un punto.

## Mixture of gaussians
```{r gaussians, echo = FALSE}
library(mclust)
mc<-Mclust(datosClustering[,1:4],4)
plot(mc, what = "classification", main="MClust Classification")
datosClustering$mxGau<-mc$classification
g1PMC<-datosClustering[datosClustering$mxGau==1,]
g2PMC<-datosClustering[datosClustering$mxGau==2,]
g3PMC<-datosClustering[datosClustering$mxGau==3,]
g4PMC<-datosClustering[datosClustering$mxGau==4,]
```

En este gráfico se puede observar como en cada combinación de gráficos sucede la combinación de grupos y se observan los clusters bastante separados y bien identificados.

## Fuzzy C-means
```{r fuzzy2, echo=FALSE}
library(e1071)#para cmeans
library(cluster)
set.seed(123)
fcmf<-cmeans(datosClustering[,1:4],4)
datosClustering$FCGrupos<-fcmf$cluster
g1FCM <- datosClustering[datosClustering$FCGrupos == 1,]
g2FCM <- datosClustering[datosClustering$FCGrupos == 2,]
g3FCM <- datosClustering[datosClustering$FCGrupos == 3,]
g4FCM <- datosClustering[datosClustering$FCGrupos == 4,]

clusplot(datosClustering, fcmf$cluster, color=TRUE, shade = TRUE, labels = 2,lines = 0)

library(fpc)
plotcluster(datosClustering,fcmf$cluster)
```

En el primer gráfico, clusplot, se puede ver detrás las regiones y como se encuentran los datos, además se indica que se explica casi 64% del punto de variabilidad.

En el segundo gráfico se encuentran ya separados los clusters y es posible observar la variabilidad entre ellos.

```{r analisis de cada grupo kmeans, echo=FALSE}
summary(gkm1)
summary(gkm2)
summary(gkm3)
summary(gkm4)
```

Observando los resúmenes de cada cluster podemos darnos cuenta que en el clustering por kmeans podemos observar que una de las divisiones más evidentes se realizó por la edad del hombre, en donde el grupo 1 tiene los que se encuentran entre 14-22, el 2 entre 22-39, el 3 entre 40-86 y el 4 parece ser un complemento del 1 en donde se encuentran los de 14-24. Las edades de las mujeres de los grupos no parece ser un factor determinante al igual que el año de registro.

```{r analisis de cada grupo mixture gaussians, echo=FALSE}
summary(g1PMC)
summary(g2PMC)
summary(g3PMC)
summary(g4PMC)
```

En este resúmen podemos identificar que se agrupo principalmente en relación al año, el grupo 1 se encuentran los años 2015-2020, 2 2012-2015, 3 2009,2012 y el 4to parece ser un complemento del 1ro. las edades parecen ser similares a través de los grupos.

```{r analisis de cada grupo fuzzy c means, echo=FALSE}
summary(g1FCM)
summary(g2FCM)
summary(g3FCM)
summary(g4FCM)
```

En el resúmer por fuzzy se puede identificar que la media de la edad de las mujeres parece ser constante, los años un poco variados pero en cierta manera se observa una relación entre año y edad del hombre.


## Evaluación de la tendencia de agrupamiento:
En esté análisis de datos consiste en examinar si los datos son agrupables, es decir, si los datos contienen cualquier estructura de agrupación inherente. Esto debe comprobarse antes de aplicar el análisis de agrupación.

Hopkins estadística: si el valor de Hopkins estadística está cerca de cero muy por debajo de 0,5, entonces podemos concluir que el conjunto de datos es significativamente clusterable.
VAT evaluación visual de la tendencia de agrupamiento: la cubeta detecta la tendencia de agrupamiento en una forma visual contando el número de bloques oscuros o coloreados de forma cuadrada a lo largo de la diagonal en una imagen de rectangulos.

### En hombres
```{r Evaluacion de la tendencia de agrupamiento:cluster jerarquico, echo=FALSE}

clarax <- clara(datosMatrimonio$EDADMUJ , 3)
# Cluster plot
  
plot(silhouette(clarax),  col = 2:3, main = "Silhouette plot")  
```

### En mujeres

```{r elegir los algoritmos de agrupación apropiados, echo=FALSE}

clorax <- clara(datosMatrimonio$EDADHOM , 3)

# Cluster plot
plot(silhouette(clorax),  col = 2:3, main = "Silhouette plot")
```

## Conclusiones:

La ley guatemalteca, establece la mayoría de edad, como determinante de la libre
aptitud para contraer matrimonio, no obstante, por medio de la simple autorización de
los padres, tutores o padres adoptivos en su caso, o un Juez a través de la dispensa
judicial, los menores de edad pueden contraer matrimonio civil, a los 16 años los
varones, y a los 14 las mujeres. A través de los datos analizados, se han podido observar la gran cantida de matrimonios con ambos o un individuo menores de edad por ende es una realidad que se utiliza de manera recurrente la autorización de los padres para poder contraer matrimonio cuando aún no se ha cumplido la mayoría de edad. Esto no significa que la autorización de los padres sea cien por ciento veridica o no forzada. 

Durante la experiencia en el análsis, ha dejado ver muchos casos en los que aunque uno, o los dos contrayentes son menores de edad, han logrado realizar los fines del matrimonio,
especialmente en cuanto a permanencia, fidelidad y auxilio mutuo, por lo que no
debe negárseles indiscriminadamente su derecho, pero también es cierto, que las
épocas han cambiado, y en la actualidad, los matrimonios entre adolescentes son
más propensos a la separación, o al divorcio al enfrentar situaciones adversas. Esto conlleva a analizar los posibles matrimonios infantiles y es que este se considera una
forma de matrimonio forzoso, ya que no se cuenta con el consentimiento pleno, libre e informado de una de las partes o de ninguna de ellas.

Dentro de la información generada a partir de los datos del INE, sobre los años de las mujeres que han contraido matrimonio de 12 a 25 años de edad se observa que, en la categoría de casadas, los porcentajes más altos se encuentran en las mujeres del rango de 21 a 25 años, de igual manera en la categoría de alguna vez unida o casada, las mujeres en este rango de edad, representan más del 70%. Un 10% de quienes responden que están casadas son niñas y adolescentes del rango de 15 a 17 años, mientras que el 25.4% en esta categoría de casadas pertenece al rango de mujeres de 18 a 20 años. Se destaca que las más jóvenes, adolescentes de 12 a 14 años, representan un 3.5% de la categoría haber estado alguna vez casadas. Estos datos han variado a partir de las reformas impuestas en Reforma el artículo 81 del Código Civil, Decreto Ley 106, artículos: 81, relativo a la aptitud para contraer matrimonio y establece que la edad mínima para contraer matrimonio es de 18 años; 82, relativo a la excepción a la edad mínima y la establece en 16 años, cuando concurran razones fundadas; 84, relativo a la autorización judicial para que los menores de edad puedan contraer matrimonio; 177 en el que prohíbe la unión de menores de edad.Publicada el Lunes, 23 de noviembre del 2015.


#----------Regresión lineal


#---------------------------Apartado de predición----------------------------------

Con el fin de poder investigar más a fondo bajo que criterios es más probable que en un casamiento se encuentre implicada una mujer menor de edad (que en el análisis anterior se evidenció era más recurrente que los hombres) se decidió untilizar ML para poder predecir si dado ciertas características una mujer será menor de edad en un matrimonio, para poder determinar en que lugares (o situaciones) debe ser atendido este problema.

Con el objetivo de poder estudiar por categorias, se realizará una variable de clasificación adicional en el dataframe para poder llevar a cabo la predicción

```{r Clasificación, echo=FALSE}
datosMatrimonio$clasificacion <- ifelse(datosMatrimonio$EDADMUJ <= 17, "Menor", ifelse(datosMatrimonio$EDADMUJ >= 18, "Mayor",NA))
datosMatrimonio$y <- factor(datosMatrimonio$clasificacion)
```
ss

```{r Filtrado, echo=FALSE}
datosML <- datosMatrimonio %>% filter(EDADMUJ >= 12)
datosML <- datosML %>% filter(EDADHOM >= 14)
datosML <- datosML[,-24]
```


```{r train and test, echo=FALSE}
porciento <- 70/100
set.seed(123)

trainRowsNumber<-sample(nrow(datosML),porciento*nrow(datosML))
train<-datosML[trainRowsNumber,]
test<-datosML[-trainRowsNumber,]
```


```{r Rweka clasificación, echo=FALSE}
datosML <- lapply(datosML, as.factor)
NB <- make_Weka_classifier("weka/classifiers/functions/MultilayerPerceptron")
NB 
WOW(NB)
nnodos='23'

modelo.bp<-NB(datosML$y~., data=datosML,subset = trainRowsNumber, control=Weka_control(H=nnodos, N=1000, G=TRUE), options=NULL)
test$prediccionWeka<-predict(modelo.bp, newdata = test[,1:23])
cfmWeka<-confusionMatrix(test$prediccionWeka,test$y)
cfmWeka
```

```{r nnet clasificación, echo=FALSE}


modelo.nn2 <- nnet(datosML$y~.,data = datosML,subset = trainRowsNumber, size=2, rang=0.1,
                   decay=5e-4, maxit=200) 
prediccion2 <- as.data.frame(predict(modelo.nn2, newdata = test[,1:23]))
columnaMasAlta<-apply(prediccion2, 1, function(x) colnames(prediccion2)[which.max(x)])
test$prediccion2<-columnaMasAlta 

cfm<-confusionMatrix(as.factor(test$prediccion2),test$y)
cfm
```

